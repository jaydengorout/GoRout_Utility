{"version":3,"sources":["User.es6"],"names":["utils","User","metaRef","get","push","_firebase","window","firebase","auth","currentUser","cb","database","ref","once","snapshot","data","val","e","uid","bind","user","child","displayName","providerData","photoURL","email","meta","exists","set","off","dataLayer","helper","DataLayerHelper","message","model","update","flatten","a","sync","emit","key","onlineStatus","root","userRef","onlineRef","on","onDisconnect","remove","id","online","lastSeen","ServerValue","TIMESTAMP"],"mappings":"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","file":"User.js","sourcesContent":["/**\r\n * Created by jayde on 12/26/2016.\r\n */\r\n\r\nimport {DataSync} from './DataSync';\r\nimport * as utils from './../utility';\r\n\r\n\r\nclass User extends DataSync{\r\n  constructor(){\r\n    super('User');\r\n    this.metaRef = null;\r\n    this.get = null;\r\n    this.push = null;\r\n    this._firebase = window.firebase;\r\n  }\r\n\r\n  isAuthenticated(){\r\n    return (typeof(this._firebase.auth().currentUser)==='object');\r\n  }\r\n\r\n  isAdmin(cb){\r\n    this._firebase.database().ref('admins').once('value',function(snapshot){\r\n      var data = snapshot.val();\r\n      var e = !(!data[this._firebase.auth().currentUser.uid]);\r\n      cb(e);\r\n    }.bind(this))\r\n  }\r\n\r\n  loadUser(user) {\r\n    if(user){\r\n      this._firebase.database().ref().child('users').child(user.uid).once('value',function(snapshot){\r\n        var data = {\r\n          displayName: user.providerData[0].displayName,\r\n          photoURL: user.providerData[0].photoURL,\r\n          email: user.providerData[0].email,\r\n          meta: null,\r\n        };\r\n        if(!snapshot.exists()){\r\n          data = {\r\n            displayName: user.providerData[0].displayName,\r\n            photoURL: user.providerData[0].photoURL,\r\n            email: user.providerData[0].email,\r\n            meta: null,\r\n          };\r\n          this._firebase.database().ref().child('users').child(user.uid).set(data);\r\n        }else{\r\n          data = snapshot.val();\r\n        }\r\n        this.data = data;\r\n        this._firebase.database().ref().child('users').child(user.uid).off()\r\n        /**\r\n         * setting up meta stuff\r\n         */\r\n        this.metaRef = this._firebase.database().ref().child('users').child(user.uid).child('meta');\r\n        this.metaRef.off();\r\n        var dataLayer = [data.meta];\r\n        var helper = new DataLayerHelper(dataLayer, (message, model)=>{\r\n          this.metaRef.update(model);\r\n          helper.flatten();\r\n          this.data.meta = helper.a;\r\n          this.sync();\r\n          this.emit('updated');\r\n        });\r\n        this.get = function(key){\r\n          return helper.get(key);\r\n        };\r\n        this.push = function(data){\r\n          dataLayer.push(data);\r\n        };\r\n        /***********************************\r\n         *\r\n         */\r\n        var onlineStatus = (function(root,user){\r\n          var userRef = root._firebase.database().ref('users').child(user.uid);\r\n          var onlineRef = root._firebase.database().ref('onlineUsers/'+user.uid);\r\n          root._firebase.database().ref('/.info/connected').on('value',function(snapshot){\r\n            if(snapshot.exists()){\r\n              onlineRef.onDisconnect().remove();\r\n              onlineRef.set({id:user.uid,data:user.providerData[0]});\r\n              userRef.onDisconnect().update({online:false,lastSeen:firebase.database.ServerValue.TIMESTAMP});\r\n              userRef.update({online:true});\r\n            }\r\n          })\r\n        })(this,user);\r\n      }.bind(this));\r\n    }else{\r\n      this.emit('NotAuthenticated');\r\n    }\r\n  }\r\n\r\n}"]}